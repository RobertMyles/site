{
  "hash": "5a350c630f91d96610f2c41c50e8ef1e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Graphing Six Nations History\"\ndate: \"2024-03-18\"\nexecute: \n  eval: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(readr)\n\nsixn <- tibble(\n  year = 2000:2024,\n  england = c(\n    1, 1, 2, 1, 3, 4, 4, 3, 2, 2, 3, 1, rep(2, 4), 1, 1, 5, 2, 1, 5, 3, 4, 3\n    ),\n  france = c(\n    2, 5, 1, 3, 1, 2, 1, 1, 3, 3, 1, 2, 4, 6, 4, 4, 5, 3, 4, 4, 2, 2, 1, 2, 2\n    ),\n  ireland = c(\n    3, 2, 3, 2, 2, 3, 2, 2, 4, 1, 2, 3, 3, 5, 1, 1, 3, 2, 1, 3, 3, 3, 2, 1, 1\n    ),\n  italy = c(rep(6, 3), 5, 5, 6, 6, 4, rep(6, 4), 5, 4, 6, 5, rep(6, 8), 5),\n  scotland = c(\n    5, 3, 4, 4, 6, 5, 3, 6, rep(5, 4), 6, 3, 5, 6, 5, 5, 4, 5, rep(4, 3), 3, 4\n    ),\n  wales = c(\n    4, 4, 5, 6, 4, 1, 5, 5, 1, rep(4, 3), 1, 1, 3, 3, 2, 5, 2, 1, 5, 1, 5, 5, 6\n    )\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(sixn)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 7\n   year england france ireland italy scotland wales\n  <int>   <dbl>  <dbl>   <dbl> <dbl>    <dbl> <dbl>\n1  2000       1      2       3     6        5     4\n2  2001       1      5       2     6        3     4\n3  2002       2      1       3     6        4     5\n4  2003       1      3       2     5        4     6\n5  2004       3      1       2     5        6     4\n6  2005       4      2       3     6        5     1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsixn_long <- pivot_longer(sixn, cols = c(england:wales))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(sixn_long)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n   year name     value\n  <int> <chr>    <dbl>\n1  2000 england      1\n2  2000 france       2\n3  2000 ireland      3\n4  2000 italy        6\n5  2000 scotland     5\n6  2000 wales        4\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsixn_long <- sixn_long |> mutate(value = as.character(value))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sixn_long, aes(x = year, y = value, group = name, colour = name)) +\n  geom_line() +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sixn_long, aes(x = year, y = value, group = name, colour = name)) +\n  geom_line() +\n  geom_point() +\n  scale_y_discrete(limits=rev)\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsixn_long <- mutate(\n  sixn_long, year = as.character(year)\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sixn_long, aes(x = year, y = value, group = name, colour = name)) +\n  geom_line() +\n  geom_point() +\n  scale_y_discrete(limits=rev)\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lubridate)\nlibrary(glue)\n\nsixn_dates <- sixn_long |> \n  mutate(\n    year = glue(\"{year}-01-01\"),\n    year = as_datetime(year)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sixn_dates, aes(x = year, y = value, group = name, colour = name)) +\n  geom_line() +\n  geom_point() +\n  scale_y_discrete(limits=rev) +\n  scale_x_datetime(date_breaks = \"2 years\", date_labels = \"%Y\")\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\nScotland's navy is #1D4976, Ireland's crest #296044, the famous Wales red is #DB4733, we'll go with white for England, which is #FFFFFF.\n\nBoth France and Italy use a few colours, Italy's blue from their crest is #275DA1 and France's blue is #133472. That's three blues in there, let's hope we can tell them apart. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sixn_dates, aes(x = year, y = value, group = name, colour = name)) +\n  geom_line() +\n  geom_point() +\n  scale_y_discrete(limits=rev) +\n  scale_x_datetime(date_breaks = \"2 years\", date_labels = \"%Y\") +\n  scale_colour_manual(values = c(\"#FFFFFF\", \"#133472\", \"#296044\", \"#275DA1\", \"#1D4976\", \"#DB4733\"))\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sixn_dates, aes(x = year, y = value, group = name, colour = name)) +\n  geom_line() +\n  geom_point() +\n  scale_y_discrete(limits=rev) +\n  scale_x_datetime(date_breaks = \"2 years\", date_labels = \"%Y\") +\n  scale_colour_manual(values = c(\"#FFFFFF\", \"#133472\", \"#296044\", \"#275DA1\", \"#1D4976\", \"#DB4733\"))+\n  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sixn_dates, aes(x = year, y = value, group = name, colour = name)) +\n  geom_line() +\n  geom_point() +\n  scale_y_discrete(limits=rev) +\n  scale_x_datetime(date_breaks = \"2 years\", date_labels = \"%Y\") +\n  scale_colour_manual(values = c(\"#FFFFFF\", \"#133472\", \"#296044\", \"#275DA1\", \"#1D4976\", \"#DB4733\")) +\n  theme(\n    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),\n    panel.background = element_rect(fill = \"#d9d9d9\", colour = \"#8c8c8c\")\n    )\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsixn_dates |> \n  mutate(\n    name = str_to_title(name),\n    yy = year(year),\n    slam = case_when(\n      yy %in% c(2002, 2004, 2010, 2022) & name == \"France\" ~ TRUE,\n      yy %in% c(2003, 2016) & name == \"England\" ~ TRUE,\n      yy %in% c(2005, 2008, 2012, 2019) & name == \"Wales\" ~ TRUE,\n      yy %in% c(2009, 2018, 2023) & name == \"Ireland\" ~ TRUE,\n      .default = FALSE\n      )\n    ) |> \n  ggplot(aes(x = year, y = value, group = name, fill = slam)) +\n  geom_line() +\n  geom_point(shape = 21, size = 3) +\n  scale_y_discrete(limits=rev) +\n  scale_x_datetime(date_breaks = \"4 years\", date_labels = \"%Y\") +\n  facet_wrap(~name, axis.labels = \"all_y\") +\n  scale_fill_manual(values = c(\"ghostwhite\", \"gold\")) +\n  guides(fill = \"none\") +\n  geom_smooth(se = FALSE) +\n  theme_minimal() +\n  labs(x = NULL, y = NULL)\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n\n## ToL article\n\nSo Barnes talks about point difference (https://www.thetimes.co.uk/article/ireland-defence-coach-simon-easterby-first-pick-lions-tour-zjf26pkn0). Let's get that from data copied from https://raw.githubusercontent.com/pymc-devs/pymc-examples/main/examples/data/rugby.csv.\n\nSo that's nice but it's only a few years. Let's go to Wikipedia (support it!) to get all the years. \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rvest)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'rvest'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:readr':\n\n    guess_encoding\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(glue)\nlibrary(purrr)\n\nperiod <- 2000:2024\n\nurls <- map(period, ~{\n  glue(\"https://en.wikipedia.org/wiki/{.x}_Six_Nations_Championship\")\n})\n\npages <- map(urls, read_html)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl <- '//*[@id=\"mw-content-text\"]/div[1]/h2[3]/following-sibling::table'\n\nresults <- map(pages, ~{html_node(.x, xpath=tbl)}) |> \n  map(html_table)\n\nfor (i in seq_along(period)) {\n  results[[i]]$year <- period[i]\n}\n\nrugger <- list_rbind(results) |> \n  select(Pos:year, -T) |> \n  mutate(\n    PD = PF - PA,\n    slam = case_when(\n      year %in% c(2002, 2004, 2010, 2022) & Team == \"France\" ~ 0.25,\n      year %in% c(2003, 2016) & Team == \"England\" ~ 0.25,\n      year %in% c(2005, 2008, 2012, 2019) & Team == \"Wales\" ~ 0.25,\n      year %in% c(2009, 2018, 2023) & Team == \"Ireland\" ~ 0.25,\n      .default = 0\n      )\n    )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(rugger)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 12\n    Pos Team       Pld     W     D     L    PF    PA    PD   Pts  year  slam\n  <int> <chr>    <int> <int> <int> <int> <int> <int> <int> <int> <int> <dbl>\n1     1 England      5     4     0     1   183    70   113     8  2000     0\n2     2 France       5     3     0     2   140    92    48     6  2000     0\n3     3 Ireland      5     3     0     2   168   133    35     6  2000     0\n4     4 Wales        5     3     0     2   111   135   -24     6  2000     0\n5     5 Scotland     5     1     0     4    95   145   -50     2  2000     0\n6     6 Italy        5     1     0     4   106   228  -122     2  2000     0\n```\n\n\n:::\n:::\n\n\nYou can get it [here](https://raw.githubusercontent.com/RobertMyles/blogdata/master/sixnations.csv). \n\n\n::: {.cell}\n\n```{.r .cell-code}\nrugger |> \n  ggplot(aes(x = PD, group = Team, fill = Team)) +\n  geom_boxplot() +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nok, so let's create a \"dominance index\". We'll go naively here since we don't want to go too deep down the rabbit-hole of creating indices. I think a Grand Slam is generally regarding as a major achievement, so let's use that, as well as the points difference (PD), which we can rescale. Since `slam` is 0.25 or 0, let's rescale `PD` to between 0 and 1. We'll add the two to get our index. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(scales)\n\nrugger <- rugger |> mutate(\n  PD = rescale(PD, to = c(0, 1)),\n  dominance = PD + slam\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrugger |> \n  arrange(desc(dominance)) |> \n  select(Team, year, dominance) |> \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  Team     year dominance\n  <chr>   <int>     <dbl>\n1 England  2003      1.18\n2 France   2004      1.05\n3 Wales    2008      1.05\n4 France   2002      1.05\n5 Ireland  2023      1.04\n6 Ireland  2018      1.04\n```\n\n\n:::\n:::\n\n\nThis dominance value is what we'll model with a time-series.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nrugger |> \n  ggplot(aes(x = year, y = dominance, group = Team, colour = Team)) +\n  geom_line() +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](sixn_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\nA potential model could be:\n\n$$y = y_{t-1} + \\alpha + \\text{slam} + \\text{points difference}$$ \n\n\n",
    "supporting": [
      "sixn_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}